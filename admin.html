<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Admin Dashboard - CH Cleaners</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<style>
:root {
    --earthen-darkest: #0A0908;
    --earthen-slate: #22333B;
    --earthen-ivory: #EAE0D5;
    --earthen-gold: #C6AC8E;
    --earthen-mocha: #5E503F;
    --success: #006B54;
    --error: #C1414D;
    --warning: #f59e0b;
    --info: #3b82f6;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Raleway', sans-serif;
    background: linear-gradient(135deg, var(--earthen-ivory) 0%, #f5efe6 100%);
    color: var(--earthen-darkest);
    padding: 2rem;
    min-height: 100vh;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
}

.header {
    background: linear-gradient(135deg, var(--earthen-slate) 0%, var(--earthen-mocha) 100%);
    color: white;
    padding: 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.header h1 {
    font-size: 2.5em;
    margin-bottom: 0.5rem;
}

.header p {
    opacity: 0.9;
    font-size: 1.1em;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-card .icon {
    font-size: 2.5em;
    margin-bottom: 0.5rem;
}

.stat-card .label {
    font-size: 0.9em;
    color: var(--earthen-mocha);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.stat-card .value {
    font-size: 2.5em;
    font-weight: 700;
    color: var(--earthen-slate);
    margin: 0.25rem 0;
}

.stat-card .trend {
    font-size: 0.9em;
    margin-top: 0.5rem;
}

.trend.up { color: var(--success); }
.trend.down { color: var(--error); }

.content-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}

.card {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.card h2 {
    font-size: 1.5em;
    margin-bottom: 1.5rem;
    color: var(--earthen-slate);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.submissions-list {
    max-height: 600px;
    overflow-y: auto;
}

.submission-item {
    padding: 1rem;
    border: 1px solid var(--earthen-ivory);
    border-radius: 10px;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
}

.submission-item:hover {
    background: var(--earthen-ivory);
    transform: translateX(5px);
}

.submission-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.submission-cleaner {
    font-weight: 700;
    font-size: 1.1em;
    color: var(--earthen-slate);
}

.submission-date {
    font-size: 0.9em;
    color: var(--earthen-mocha);
}

.submission-stats {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
    font-size: 0.9em;
}

.submission-stat {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.chart-container {
    width: 100%;
    height: 300px;
    margin-top: 1rem;
}

.filter-bar {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.filter-bar input,
.filter-bar select {
    padding: 0.75rem 1rem;
    border: 1px solid var(--earthen-ivory);
    border-radius: 10px;
    font-family: 'Raleway', sans-serif;
    font-size: 1em;
}

.filter-bar button {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, var(--earthen-gold) 0%, #b39a7d 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.filter-bar button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 600;
}

.badge.success { background: #d1fae5; color: var(--success); }
.badge.warning { background: #fef3c7; color: var(--warning); }
.badge.error { background: #fee2e2; color: var(--error); }

.empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--earthen-mocha);
}

.empty-state .icon {
    font-size: 4em;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.back-link {
    display: inline-block;
    margin-bottom: 2rem;
    padding: 0.75rem 1.5rem;
    background: white;
    color: var(--earthen-slate);
    text-decoration: none;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.back-link:hover {
    transform: translateX(-5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.urgent-indicator {
    display: inline-block;
    width: 8px;
    height: 8px;
    background: var(--error);
    border-radius: 50%;
    margin-right: 0.5rem;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.export-btn {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: linear-gradient(135deg, var(--earthen-slate) 0%, var(--earthen-mocha) 100%);
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5em;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    border: none;
}

.export-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

@media (max-width: 768px) {
    body {
        padding: 1rem;
    }
    
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
    
    .stat-card .value {
        font-size: 2em;
    }
}

.performance-chart {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.performance-bar {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.performance-label {
    min-width: 100px;
    font-weight: 600;
    font-size: 0.9em;
}

.performance-track {
    flex: 1;
    height: 30px;
    background: var(--earthen-ivory);
    border-radius: 15px;
    overflow: hidden;
    position: relative;
}

.performance-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--earthen-gold) 0%, #b39a7d 100%);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    color: white;
    font-weight: 600;
    font-size: 0.85em;
    transition: width 0.5s ease;
}
</style>
</head>
<body>
<div class="container">
    <a href="index.html" class="back-link">‚Üê Back to Checklist</a>
    
    <div class="header">
        <h1>üìä Admin Dashboard</h1>
        <p>Cleaning Reports Analytics & Tracking</p>
    </div>
    
    <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
            <div class="icon">üìù</div>
            <div class="label">Total Reports</div>
            <div class="value" id="totalReports">0</div>
            <div class="trend up" id="reportsTrend">Loading...</div>
        </div>
        
        <div class="stat-card">
            <div class="icon">‚è±Ô∏è</div>
            <div class="label">Avg. Completion Time</div>
            <div class="value" id="avgTime">0:00</div>
            <div class="trend" id="timeTrend">Loading...</div>
        </div>
        
        <div class="stat-card">
            <div class="icon">‚úÖ</div>
            <div class="label">Avg. Completion Rate</div>
            <div class="value" id="avgCompletion">0%</div>
            <div class="trend up" id="completionTrend">Loading...</div>
        </div>
        
        <div class="stat-card">
            <div class="icon">üö®</div>
            <div class="label">Urgent Issues</div>
            <div class="value" id="urgentCount">0</div>
            <div class="trend" id="urgentTrend">Last 30 days</div>
        </div>
    </div>
    
    <div class="content-grid">
        <div class="card">
            <h2>üìã Recent Submissions</h2>
            <div class="filter-bar">
                <input type="text" id="searchInput" placeholder="Search by cleaner name...">
                <select id="filterCleaner">
                    <option value="">All Cleaners</option>
                </select>
                <select id="filterPeriod">
                    <option value="7">Last 7 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="90">Last 90 days</option>
                    <option value="all">All time</option>
                </select>
                <button onclick="refreshData()">üîÑ Refresh</button>
            </div>
            <div class="submissions-list" id="submissionsList">
                <div class="empty-state">
                    <div class="icon">üì≠</div>
                    <p>No submissions found in localStorage.</p>
                    <p style="font-size: 0.9em; margin-top: 0.5rem;">Data will appear here after cleaners submit reports.</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>üìà Performance Metrics</h2>
            <div class="performance-chart" id="performanceChart">
                <div class="performance-bar">
                    <div class="performance-label">Bedroom</div>
                    <div class="performance-track">
                        <div class="performance-fill" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="performance-label">Kitchen</div>
                    <div class="performance-track">
                        <div class="performance-fill" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="performance-label">Bathroom</div>
                    <div class="performance-track">
                        <div class="performance-fill" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="performance-label">Final Check</div>
                    <div class="performance-track">
                        <div class="performance-fill" style="width: 0%">0%</div>
                    </div>
                </div>
            </div>
            
            <h2 style="margin-top: 2rem;">üë• Cleaner Rankings</h2>
            <div id="cleanerRankings" style="margin-top: 1rem;">
                <div class="empty-state">
                    <p style="font-size: 0.9em;">Rankings will appear after submissions.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<button class="export-btn" onclick="exportData()" title="Export Data">üíæ</button>

<script>
// Mock data structure for testing - replace with actual localStorage reads
let submissionsData = [];

function loadSubmissions() {
    const stored = localStorage.getItem('cleaningSubmissions');
    if (stored) {
        try {
            submissionsData = JSON.parse(stored);
        } catch (e) {
            console.error('Error parsing submissions:', e);
            submissionsData = [];
        }
    }
    
    // Add some sample data if empty (for demo purposes - remove in production)
    if (submissionsData.length === 0) {
        submissionsData = generateSampleData();
    }
    
    updateDashboard();
}

function generateSampleData() {
    // Sample data for demonstration
    const cleaners = ['Hazel Ann', 'Ate Kriss'];
    const sampleData = [];
    
    for (let i = 0; i < 15; i++) {
        const date = new Date();
        date.setDate(date.getDate() - Math.floor(Math.random() * 30));
        
        sampleData.push({
            cleanerName: cleaners[Math.floor(Math.random() * cleaners.length)],
            startTime: '09:00',
            endTime: '11:30',
            timestamp: date.toISOString(),
            completionRate: 85 + Math.floor(Math.random() * 15),
            hasUrgent: Math.random() > 0.8,
            photoCount: 3 + Math.floor(Math.random() * 5),
            notes: Math.random() > 0.7 ? 'Some notes here' : '',
            isWeekend: date.getDay() === 0 || date.getDay() === 6
        });
    }
    
    return sampleData;
}

function updateDashboard() {
    updateStats();
    updateSubmissionsList();
    updatePerformanceChart();
    updateCleanerRankings();
    updateFilterOptions();
}

function updateStats() {
    const totalReports = submissionsData.length;
    document.getElementById('totalReports').textContent = totalReports;
    
    if (totalReports > 0) {
        // Calculate average completion time
        const times = submissionsData.map(s => {
            const [sh, sm] = s.startTime.split(':').map(Number);
            const [eh, em] = s.endTime.split(':').map(Number);
            return (eh * 60 + em) - (sh * 60 + sm);
        });
        const avgMinutes = times.reduce((a, b) => a + b, 0) / times.length;
        const hours = Math.floor(avgMinutes / 60);
        const mins = Math.floor(avgMinutes % 60);
        document.getElementById('avgTime').textContent = `${hours}:${String(mins).padStart(2, '0')}`;
        
        // Average completion rate
        const avgCompletion = submissionsData.reduce((sum, s) => sum + (s.completionRate || 0), 0) / totalReports;
        document.getElementById('avgCompletion').textContent = Math.round(avgCompletion) + '%';
        
        // Urgent issues
        const urgentCount = submissionsData.filter(s => s.hasUrgent).length;
        document.getElementById('urgentCount').textContent = urgentCount;
        
        document.getElementById('reportsTrend').textContent = `+${totalReports} this period`;
        document.getElementById('timeTrend').textContent = avgMinutes < 150 ? '‚úì On target' : '‚ö† Above target';
        document.getElementById('completionTrend').textContent = avgCompletion > 90 ? '‚úì Excellent' : '‚Üí Good';
    }
}

function updateSubmissionsList() {
    const list = document.getElementById('submissionsList');
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const filterCleaner = document.getElementById('filterCleaner').value;
    const filterPeriod = parseInt(document.getElementById('filterPeriod').value);
    
    let filtered = submissionsData.filter(s => {
        const matchesSearch = s.cleanerName.toLowerCase().includes(searchTerm);
        const matchesCleaner = !filterCleaner || s.cleanerName === filterCleaner;
        
        let matchesPeriod = true;
        if (filterPeriod !== 'all') {
            const submissionDate = new Date(s.timestamp);
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - filterPeriod);
            matchesPeriod = submissionDate >= cutoffDate;
        }
        
        return matchesSearch && matchesCleaner && matchesPeriod;
    });
    
    if (filtered.length === 0) {
        list.innerHTML = `
            <div class="empty-state">
                <div class="icon">üì≠</div>
                <p>No submissions match your filters.</p>
            </div>
        `;
        return;
    }
    
    filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    
    list.innerHTML = filtered.map(s => {
        const date = new Date(s.timestamp);
        const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        const formattedTime = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        
        return `
            <div class="submission-item">
                <div class="submission-header">
                    <div class="submission-cleaner">
                        ${s.hasUrgent ? '<span class="urgent-indicator"></span>' : ''}
                        ${s.cleanerName}
                        ${s.isWeekend ? '<span class="badge warning">Weekend</span>' : ''}
                    </div>
                    <div class="submission-date">${formattedDate} at ${formattedTime}</div>
                </div>
                <div class="submission-stats">
                    <div class="submission-stat">
                        <span>‚è±Ô∏è</span>
                        <span>${s.startTime} - ${s.endTime}</span>
                    </div>
                    <div class="submission-stat">
                        <span>‚úÖ</span>
                        <span>${s.completionRate}% complete</span>
                    </div>
                    <div class="submission-stat">
                        <span>üì∏</span>
                        <span>${s.photoCount} photos</span>
                    </div>
                    ${s.notes ? `<div class="submission-stat"><span>üìù</span><span>Has notes</span></div>` : ''}
                </div>
            </div>
        `;
    }).join('');
}

function updatePerformanceChart() {
    // Mock performance data
    const sections = ['Bedroom', 'Kitchen', 'Bathroom', 'Final Check'];
    const bars = document.querySelectorAll('.performance-fill');
    
    sections.forEach((section, index) => {
        const percentage = 85 + Math.floor(Math.random() * 15);
        if (bars[index]) {
            bars[index].style.width = percentage + '%';
            bars[index].textContent = percentage + '%';
        }
    });
}

function updateCleanerRankings() {
    const rankings = {};
    
    submissionsData.forEach(s => {
        if (!rankings[s.cleanerName]) {
            rankings[s.cleanerName] = {
                reports: 0,
                avgCompletion: 0,
                avgTime: 0
            };
        }
        rankings[s.cleanerName].reports++;
        rankings[s.cleanerName].avgCompletion += s.completionRate || 0;
        
        const [sh, sm] = s.startTime.split(':').map(Number);
        const [eh, em] = s.endTime.split(':').map(Number);
        rankings[s.cleanerName].avgTime += (eh * 60 + em) - (sh * 60 + sm);
    });
    
    const rankingHTML = Object.entries(rankings)
        .sort((a, b) => (b[1].avgCompletion / b[1].reports) - (a[1].avgCompletion / a[1].reports))
        .map(([name, data], index) => {
            const avgCompletion = Math.round(data.avgCompletion / data.reports);
            const avgMinutes = Math.round(data.avgTime / data.reports);
            const hours = Math.floor(avgMinutes / 60);
            const mins = Math.floor(avgMinutes % 60);
            
            const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
            
            return `
                <div class="submission-item" style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 1.2em; margin-right: 0.5rem;">${medal}</span>
                            <strong>${name}</strong>
                        </div>
                        <div style="text-align: right; font-size: 0.9em;">
                            <div>${data.reports} reports</div>
                            <div style="color: var(--earthen-mocha);">${avgCompletion}% avg ‚Ä¢ ${hours}:${String(mins).padStart(2, '0')} avg</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    
    document.getElementById('cleanerRankings').innerHTML = rankingHTML || '<div class="empty-state"><p style="font-size: 0.9em;">No rankings available yet.</p></div>';
}

function updateFilterOptions() {
    const cleaners = [...new Set(submissionsData.map(s => s.cleanerName))];
    const filterCleaner = document.getElementById('filterCleaner');
    const currentValue = filterCleaner.value;
    
    filterCleaner.innerHTML = '<option value="">All Cleaners</option>' +
        cleaners.map(c => `<option value="${c}">${c}</option>`).join('');
    
    filterCleaner.value = currentValue;
}

function refreshData() {
    loadSubmissions();
}

function exportData() {
    const dataStr = JSON.stringify(submissionsData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `cleaning-reports-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    URL.revokeObjectURL(url);
}

// Event listeners
document.getElementById('searchInput').addEventListener('input', updateSubmissionsList);
document.getElementById('filterCleaner').addEventListener('change', updateSubmissionsList);
document.getElementById('filterPeriod').addEventListener('change', updateSubmissionsList);

// Initialize
loadSubmissions();

// Auto-refresh every 5 minutes
setInterval(refreshData, 300000);
</script>
</body>
</html>
